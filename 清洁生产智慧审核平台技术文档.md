# 清洁生产智慧审核平台技术文档

## 1. 项目概述

清洁生产智慧审核平台是一个基于 FastAPI + Vue3 + Naive UI 的现代化前后端分离开发平台，专门用于清洁生产审核管理。平台融合了 RBAC 权限管理、动态路由和 JWT 鉴权，为清洁生产审核工作提供全方位的数字化解决方案。

### 1.1 技术栈

**前端技术栈：**

- Vue 3.3.4 - 渐进式 JavaScript 框架
- Vite 4.4.6 - 现代化构建工具
- Naive UI 2.34.4 - Vue 3 组件库
- Vue Router 4.2.4 - 官方路由管理器
- Pinia 2.1.6 - Vue 状态管理库
- UnoCSS 0.55.0 - 原子化 CSS 引擎
- Axios 1.4.0 - HTTP 客户端
- Vue I18n 9 - 国际化解决方案

**后端技术栈：**

- Python 3.11
- FastAPI - 高性能异步 Web 框架
- SQLAlchemy - ORM 数据库工具
- JWT - 身份验证
- Pydantic - 数据验证

## 2. 前端模块介绍

### 2.1 工作台模块 (Workbench)

**功能概述：**
工作台是用户登录后的首页，提供系统概览和快速操作入口。

**主要功能：**

- 系统概览仪表板
- 待办事项提醒
- 行业动态展示
- AI 智能助手
- 快捷操作入口

**实现组件：**

- `WelcomeSection.vue` - 欢迎区域
- `IndustryCard.vue` - 行业卡片
- `MetricCard.vue` - 指标卡片
- `NewsIndustrySection.vue` - 行业新闻区域
- `TodoNewsSection.vue` - 待办新闻区域
- `AIAssistant/ChatWidget.vue` - AI 助手聊天组件
- `AIAssistant/MessageBubble.vue` - 消息气泡组件

### 2.2 清洁生产管理模块 (Clean Production)

**功能概述：**
清洁生产管理是平台的核心模块，涵盖政策管理、企业审核、案例展示等全方位功能。

#### 2.2.1 清洁生产政策与管理子模块

**通知公告 (Notice)**

- 功能：发布和管理清洁生产相关通知公告
- 组件：`NoticeDetailModal.vue` - 公告详情弹窗
- 操作：查看、发布、编辑、删除公告

**动态信息 (News)**

- 功能：展示清洁生产行业动态和新闻
- 组件：`DynamicCard.vue` - 动态卡片，`DynamicList.vue` - 动态列表
- 操作：浏览、搜索、筛选动态信息

**清洁生产法规政策 (Regulations)**

- 功能：管理和展示清洁生产相关法规政策
- 组件：`RegulationList.vue` - 法规列表，`RegulationTabs.vue` - 法规标签页
- 操作：查看、分类浏览、搜索法规

**能力建设 (Capability)**

- 功能：展示人员培训和能力建设信息
- 组件：`PersonnelCard.vue` - 人员卡片，`PersonnelList.vue` - 人员列表
- 操作：查看人员信息、培训记录

**会议与宣传 (Meeting)**

- 功能：管理会议信息和宣传活动
- 组件：`MeetingCard.vue` - 会议卡片，`VideoPlayer.vue` - 视频播放器
- 操作：查看会议详情、观看会议视频

#### 2.2.2 其他清洁生产管理功能

**企业清洁生产审核管理**

- 功能：管理企业清洁生产审核流程
- 操作：审核流程跟踪、审核结果管理

**清洁生产审核典型案例**

- 功能：展示和分析典型案例
- 操作：案例浏览、分析、对比

**工业园区管理**

- 功能：管理工业园区信息和清洁生产情况
- 操作：园区信息维护、数据统计

**行业管理**

- 功能：管理不同行业的清洁生产标准和要求
- 操作：行业标准维护、分类管理

**企业管理**

- 功能：管理企业基本信息和清洁生产状态
- 操作：企业信息维护、状态跟踪

**区域管理**

- 功能：按区域管理清洁生产工作
- 操作：区域划分、数据统计

**专家库**

- 功能：管理清洁生产专家信息
- 操作：专家信息维护、专业领域管理

**国际合作**

- 功能：展示国际合作项目和交流活动
- 操作：项目跟踪、交流记录

**清洁生产技术集成**

- 功能：集成和展示清洁生产技术
- 操作：技术分类、效果评估

**清洁生产智慧决策**

- 功能：提供数据分析和决策支持
- 操作：数据分析、报告生成

### 2.3 清洁生产云审核模块 (Cloud Audit)

**功能概述：**
云审核模块提供多行业的清洁生产审核功能，支持钢铁、玻璃、焦化、PCB、家具、汽修等行业。

#### 2.3.1 钢铁行业审核

**功能：**

- 钢铁企业清洁生产审核
- 审核流程管理
- 审核报告生成

**组件：**

- `EnterpriseCard.vue` - 企业卡片
- `EnterpriseForm.vue` - 企业表单
- `AuditProgress.vue` - 审核进度

**企业详情页面功能：**

- 基本信息管理
- 筹划与组织
- 预审核
- 审核实施
- 方案库管理
- 报告生成

**专用组件：**

- `ProductionInfoForm.vue` - 生产信息表单
- `RawMaterialForm.vue` - 原材料表单
- `ResourceConsumptionForm.vue` - 资源消耗表单
- `ProcessEquipmentForm.vue` - 工艺设备表单
- `PollutionControlForm.vue` - 污染控制表单
- `SolidWasteForm.vue` - 固体废物表单
- `SelfMonitoringForm.vue` - 自行监测表单
- `SchemeForm.vue` - 方案表单
- `QuantitativeIndicator.vue` - 定量指标
- `QualitativeIndicator.vue` - 定性指标
- `LimitingIndicator.vue` - 限制性指标
- `ReportEditor.vue` - 报告编辑器

#### 2.3.2 PCB行业审核

**功能：**

- PCB企业清洁生产审核
- 专业化的PCB行业审核流程
- 行业特定指标管理

**组件：**
与钢铁行业类似，但针对PCB行业特点进行了定制化

#### 2.3.3 其他行业审核

**平板玻璃行业审核**

- 玻璃制造企业清洁生产审核
- 玻璃行业特定指标和标准

**焦化行业审核**

- 焦化企业清洁生产审核
- 焦化行业环保要求管理

**家具行业审核**

- 家具制造企业清洁生产审核
- 家具行业清洁生产标准

**汽修行业审核**

- 汽修企业清洁生产审核
- 汽修行业环保管理

### 2.4 清洁生产技术集成模块 (Technology Integration)

**功能概述：**
技术集成模块提供清洁生产技术的集成、展示和评估功能。

**主要功能：**

- 行业技术库管理
- 技术效果模拟评估
- 技术对比分析

### 2.5 清洁生产智慧决策模块 (Smart Decision)

**功能概述：**
智慧决策模块提供数据分析和决策支持功能。

**主要功能：**

- 企业分布图谱
- 清洁生产审核成效图谱
- 数据可视化分析

### 2.6 系统管理模块 (System)

**功能概述：**
系统管理模块提供平台的基础管理功能。

**主要功能：**

- 用户管理：用户账号的增删改查
- 角色管理：角色权限的配置管理
- 部门管理：组织架构管理
- 菜单管理：系统菜单配置
- 日志管理：系统操作日志查看

## 3. 前端路由配置

### 3.1 路由架构

平台采用 Vue Router 4 进行路由管理，采用模块化路由配置方式：

```javascript
// 基础路由配置
export const basicRoutes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/login/index.vue'),
    meta: { 
      title: '登录',
      hidden: true 
    }
  }
]

// 业务路由配置
export const businessRoutes = [
  workbench,           // 工作台
  cleanProduction,     // 清洁生产管理
  cloudAudit,          // 云审核
  technologyIntegration, // 技术集成
  smartDecision,       // 智慧决策
  system              // 系统管理
]
```

### 3.2 路由模块详解

#### 3.2.1 工作台路由 (workbench.js)

```javascript
export default {
  path: '/',
  name: 'Root',
  component: Layout,
  redirect: '/workbench',
  meta: { 
    title: '首页',
    icon: 'mdi:home',
    order: 0
  },
  children: [
    {
      path: 'workbench',
      name: 'Workbench',
      component: () => import('@/views/workbench/index.vue'),
      meta: { 
        title: '首页',
        icon: 'mdi:view-dashboard',
        affix: true
      }
    }
  ]
}
```

#### 3.2.2 清洁生产管理路由 (cleanProduction.js)

采用嵌套路由结构，支持多级菜单：

```javascript
export default {
  path: '/clean-production',
  name: 'CleanProduction',
  component: Layout,
  meta: { 
    title: '清洁生产管理',
    icon: 'mdi:factory',
    order: 1
  },
  children: [
    {
      path: 'policy',
      name: 'Policy',
      component: RouterView,
      meta: { 
        title: '清洁生产政策与管理',
        icon: 'mdi:file-document'
      },
      children: [
        {
          path: 'notice',
          name: 'Notice',
          component: () => import('@/views/clean-production/policy/notice/index.vue'),
          meta: { 
            title: '通知公告',
            icon: 'mdi:bell'
          }
        },
        // ... 其他子路由
      ]
    },
    // ... 其他主路由
  ]
}
```

#### 3.2.3 云审核路由 (cloudAudit.js)

支持多行业审核路由，采用动态路由参数：

```javascript
export default {
  path: '/cloud-audit',
  name: 'CloudAudit',
  component: Layout,
  meta: { 
    title: '清洁生产云审核',
    icon: 'carbon:cloud',
    order: 2
  },
  children: [
    {
      path: 'steel',
      name: 'Steel',
      component: () => import('@/views/cloud-audit/steel/index.vue'),
      meta: { 
        title: '钢铁行业审核',
        icon: 'carbon:industry'
      }
    },
    {
      path: 'steel/:id',
      name: 'SteelDetail',
      component: () => import('@/views/cloud-audit/steel/enterprise-detail/index.vue'),
      meta: { 
        title: '钢铁企业详情',
        hidden: true
      }
    },
    // ... 其他行业路由
  ]
}
```

### 3.3 路由守卫

平台实现了完整的路由守卫机制：

```javascript
router.beforeEach(async (to, from, next) => {
  // 设置页面标题
  document.title = to.meta?.title ? `${to.meta.title} - 清洁生产智慧管理平台` : '清洁生产智慧管理平台'
  
  // 检查登录状态
  const token = getToken()
  const userStore = useUserStore()
  
  if (to.path === '/login') {
    if (token) {
      next('/')
    } else {
      next()
    }
    return
  }
  
  if (!token) {
    next('/login')
    return
  }
  
  // 确保用户信息已加载
  if (!userStore.userId && token) {
    try {
      await userStore.getUserInfo()
    } catch (error) {
      next('/login')
      return
    }
  }
  
  next()
})
```

## 4. 前端组件设计

### 4.1 布局组件

#### 4.1.1 主布局 (Layout)

**文件位置：** `web/src/layout/index.vue`

**功能特点：**

- 响应式布局设计
- 侧边栏折叠功能
- 头部导航栏
- 标签页管理
- 移动端适配

**核心代码：**

```vue
<template>
  <n-layout has-sider wh-full>
    <n-layout-sider
      bordered
      collapse-mode="width"
      :collapsed-width="64"
      :width="280"
      :collapsed="appStore.collapsed"
      show-trigger
    >
      <SideBar />
    </n-layout-sider>
  
    <article flex-col flex-1 overflow-hidden>
      <header class="flex items-center border-b bg-white px-15">
        <AppHeader />
      </header>
      <section v-if="tags.visible">
        <AppTags />
      </section>
      <section flex-1 overflow-hidden>
        <AppMain />
      </section>
    </article>
  </n-layout>
</template>
```

#### 4.1.2 页面容器组件

**AppPage.vue**

- 提供页面基础容器
- 支持过渡动画
- 可配置页脚显示

**CommonPage.vue**

- 基于 AppPage 的通用页面组件
- 提供标准化的页面头部
- 支持标题和操作按钮

### 4.2 表格组件

#### 4.2.1 CrudTable 组件

**文件位置：** `web/src/components/table/CrudTable.vue`

**功能特点：**

- 支持前后端分页
- 集成查询栏
- 支持行选择
- 可配置滚动区域
- 响应式设计

**核心功能：**

```javascript
// 分页配置
const pagination = reactive({
  page: 1,
  page_size: 10,
  pageSizes: [10, 20, 50, 100],
  showSizePicker: true,
  onChange: (page) => {
    pagination.page = page
  },
  onUpdatePageSize: (pageSize) => {
    pagination.page_size = pageSize
    pagination.page = 1
    handleQuery()
  },
})

// 数据查询
async function handleQuery() {
  try {
    loading.value = true
    let paginationParams = {}
    if (props.isPagination && props.remote) {
      paginationParams = { page: pagination.page, page_size: pagination.page_size }
    }
    const { data, total } = await props.getData({
      ...props.queryItems,
      ...props.extraParams,
      ...paginationParams,
    })
    tableData.value = data
    pagination.itemCount = total || 0
  } catch (error) {
    tableData.value = []
    pagination.itemCount = 0
  } finally {
    loading.value = false
  }
}
```

#### 4.2.2 CrudModal 组件

**文件位置：** `web/src/components/table/CrudModal.vue`

**功能特点：**

- 基于 Naive UI Modal 组件
- 支持自定义宽度
- 可配置页脚显示
- 支持加载状态

### 4.3 查询组件

#### 4.3.1 QueryBar 组件

**文件位置：** `web/src/components/query-bar/QueryBar.vue`

**功能特点：**

- 提供统一的查询界面
- 支持重置和搜索操作
- 响应式布局
- 支持插槽自定义

### 4.4 业务组件

#### 4.4.1 企业卡片组件 (EnterpriseCard)

**功能：**

- 展示企业基本信息
- 支持状态显示
- 提供操作按钮

#### 4.4.2 审核进度组件 (AuditProgress)

**功能：**

- 可视化审核进度
- 支持多阶段进度显示
- 状态颜色区分

#### 4.4.3 表单组件系列

**生产信息表单 (ProductionInfoForm)**

- 企业生产基本信息录入
- 表单验证
- 数据提交

**原材料表单 (RawMaterialForm)**

- 原材料信息管理
- 支持批量操作
- 数据验证

**资源消耗表单 (ResourceConsumptionForm)**

- 资源消耗数据录入
- 计算功能
- 数据校验

**工艺设备表单 (ProcessEquipmentForm)**

- 工艺设备信息管理
- 设备状态跟踪
- 维护记录

**污染控制表单 (PollutionControlForm)**

- 污染控制措施管理
- 效果评估
- 合规检查

**固体废物表单 (SolidWasteForm)**

- 固体废物管理
- 分类统计
- 处理记录

**自行监测表单 (SelfMonitoringForm)**

- 监测数据录入
- 数据可视化
- 异常预警

**方案表单 (SchemeForm)**

- 清洁生产方案管理
- 方案对比
- 效果评估

#### 4.4.4 指标组件系列

**定量指标组件 (QuantitativeIndicator)**

- 数值型指标展示
- 计算功能
- 趋势分析

**定性指标组件 (QualitativeIndicator)**

- 描述性指标管理
- 评分系统
- 等级划分

**限制性指标组件 (LimitingIndicator)**

- 限制性指标监控
- 超标预警
- 合规检查

#### 4.4.5 报告组件

**报告编辑器 (ReportEditor)**

- 富文本编辑
- 模板支持
- 导出功能

### 4.5 工具组件

#### 4.5.1 useCRUD 组合式函数

**文件位置：** `web/src/composables/useCRUD.js`

**功能特点：**

- 提供增删改查的统一接口
- 支持模态框管理
- 表单验证
- 错误处理

**核心功能：**

```javascript
export default function ({ name, initForm = {}, doCreate, doDelete, doUpdate, refresh }) {
  const modalVisible = ref(false)
  const modalAction = ref('')
  const modalTitle = computed(() => ACTIONS[modalAction.value] + name)
  const modalLoading = ref(false)
  const modalFormRef = ref(null)
  const modalForm = ref({ ...initForm })

  // 新增
  function handleAdd() {
    modalAction.value = 'add'
    modalVisible.value = true
    modalForm.value = { ...initForm }
  }

  // 修改
  function handleEdit(row) {
    modalAction.value = 'edit'
    modalVisible.value = true
    modalForm.value = { ...row }
  }

  // 保存
  function handleSave(...callbacks) {
    modalFormRef.value?.validate(async (err) => {
      if (err) return
      const actions = {
        add: {
          api: () => doCreate(modalForm.value),
          cb: () => callbacks.forEach((callback) => callback && callback()),
          msg: () => $message.success('新增成功'),
        },
        edit: {
          api: () => doUpdate(modalForm.value),
          cb: () => callbacks.forEach((callback) => callback && callback()),
          msg: () => $message.success('编辑成功'),
        },
      }
      // ... 执行保存逻辑
    })
  }

  return {
    modalVisible,
    modalAction,
    modalTitle,
    modalLoading,
    handleAdd,
    handleDelete,
    handleEdit,
    handleView,
    handleSave,
    modalForm,
    modalFormRef,
  }
}
```

## 5. 技术特色与创新点

### 5.1 响应式设计

平台采用响应式设计，支持多种设备访问：

- 移动端适配
- 平板端优化
- PC端完整功能

### 5.2 组件化开发

- 高度组件化的开发模式
- 可复用的业务组件
- 统一的组件规范

### 5.3 状态管理

- 基于 Pinia 的状态管理
- 模块化的状态设计
- 持久化存储

### 5.4 国际化支持

- 基于 Vue I18n 的国际化
- 支持中英文切换
- 可扩展多语言

### 5.5 主题系统

- 支持明暗主题切换
- 可配置的主题色彩
- 响应式主题适配

## 6. 开发规范

### 6.1 代码规范

- ESLint 代码检查
- Prettier 代码格式化
- Git Hooks 预提交检查

### 6.2 组件规范

- 统一的组件命名规范
- 标准化的 Props 定义
- 完善的组件文档

### 6.3 路由规范

- 模块化路由配置
- 统一的 Meta 信息
- 规范的路由命名

## 7. 部署与构建

### 7.1 构建配置

- 基于 Vite 的现代化构建
- 支持代码分割
- 资源压缩优化

### 7.2 环境配置

- 多环境配置支持
- 环境变量管理
- 构建产物优化

## 8. 总结

清洁生产智慧审核平台前端采用现代化的技术栈和架构设计，具有以下特点：

1. **模块化设计**：清晰的功能模块划分，便于维护和扩展
2. **组件化开发**：高度复用的组件设计，提高开发效率
3. **响应式布局**：支持多设备访问，提供良好的用户体验
4. **规范化开发**：统一的开发规范和代码标准
5. **可扩展性**：灵活的架构设计，支持功能扩展

平台为清洁生产审核工作提供了完整的数字化解决方案，通过现代化的前端技术实现了高效、便捷的管理功能。
