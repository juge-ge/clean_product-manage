# PCB筹划与组织前端恢复方案

## 1. 方案概述

### 1.1 恢复目标
基于之前的对话记录和技术规范，恢复PCB模块筹划与组织部分的完整前端功能，包括：
- 清洁生产审核领导小组管理
- 清洁生产工作小组管理  
- 工作计划表（十个阶段）管理
- 宣传与培训记录管理（含图片上传）

### 1.2 技术架构
- **前端框架**: Vue 3 + Composition API
- **UI组件库**: Naive UI
- **状态管理**: Vue 3 reactive
- **API调用**: 基于request工具类
- **数据存储**: 连接新建的PCB筹划与组织数据库

## 2. 数据库结构确认

### 2.1 已创建的数据库表
根据技术规范，以下表已创建：
- `pcb_leadership_team` - 领导小组表
- `pcb_work_team` - 工作小组表
- `pcb_work_plans` - 工作计划表
- `pcb_training_records` - 培训记录表
- `pcb_training_images` - 培训图片表

### 2.2 API端点设计
```
GET    /api/v1/pcb/enterprise/{enterprise_id}/leadership-team
POST   /api/v1/pcb/enterprise/{enterprise_id}/leadership-team
PUT    /api/v1/pcb/enterprise/{enterprise_id}/leadership-team/{member_id}
DELETE /api/v1/pcb/enterprise/{enterprise_id}/leadership-team/{member_id}

GET    /api/v1/pcb/enterprise/{enterprise_id}/work-team
POST   /api/v1/pcb/enterprise/{enterprise_id}/work-team
PUT    /api/v1/pcb/enterprise/{enterprise_id}/work-team/{member_id}
DELETE /api/v1/pcb/enterprise/{enterprise_id}/work-team/{member_id}

GET    /api/v1/pcb/enterprise/{enterprise_id}/work-plans
PUT    /api/v1/pcb/enterprise/{enterprise_id}/work-plans

GET    /api/v1/pcb/enterprise/{enterprise_id}/training-records
POST   /api/v1/pcb/enterprise/{enterprise_id}/training-records
PUT    /api/v1/pcb/enterprise/{enterprise_id}/training-records/{record_id}
DELETE /api/v1/pcb/enterprise/{enterprise_id}/training-records/{record_id}
```

## 3. 前端组件恢复方案

### 3.1 主要组件结构

#### 3.1.1 文件位置
```
web/src/views/cloud-audit/pcb/enterprise-detail/planning.vue
```

#### 3.1.2 组件结构
```vue
<template>
  <div class="planning-page p-4">
    <n-spin :show="loading">
      <!-- 1. 清洁生产审核领导小组 -->
      <n-card class="mb-4 leadership-team-card">
        <!-- 领导小组内容 -->
      </n-card>
      
      <!-- 2. 清洁生产工作小组 -->
      <n-card class="mb-4 work-team-card">
        <!-- 工作小组内容 -->
      </n-card>
      
      <!-- 3. 工作计划表 -->
      <n-card class="mb-4 work-plan-container">
        <!-- 工作计划表内容 -->
      </n-card>
      
      <!-- 4. 宣传与培训 -->
      <n-card class="mb-4 training-container">
        <!-- 培训记录内容 -->
      </n-card>
    </n-spin>
  </div>
</template>
```

### 3.2 数据模型设计

#### 3.2.1 响应式数据
```javascript
// 基础数据
const loading = ref(false)
const enterpriseId = computed(() => props.enterpriseId)

// 领导小组数据
const leadershipTeam = ref([])
const leadershipLoading = ref(false)
const showAddLeadershipModal = ref(false)
const leadershipForm = ref({
  name: '',
  position: '',
  department: '',
  role: '',
  responsibilities: '',
  phone: ''
})

// 工作小组数据
const workTeam = ref([])
const workTeamLoading = ref(false)
const showAddWorkTeamModal = ref(false)
const workTeamForm = ref({
  name: '',
  position: '',
  department: '',
  role: '',
  responsibilities: '',
  phone: ''
})

// 工作计划数据
const workPlans = ref([])
const workPlanStages = ref([])
const workPlanLoading = ref(false)
const showWorkPlanModal = ref(false)

// 培训记录数据
const trainingRecords = ref([])
const trainingLoading = ref(false)
const showAddTrainingModal = ref(false)
const trainingForm = ref({
  title: '',
  date: null,
  duration: null,
  participants: null,
  content: '',
  instructor: '',
  location: ''
})
const meetingImages = ref([])
```

#### 3.2.2 表格列定义
```javascript
// 领导小组表格列
const leadershipColumns = [
  { title: '姓名', key: 'name', width: 120 },
  { title: '职位', key: 'position', width: 150 },
  { title: '部门', key: 'department', width: 150 },
  { title: '角色', key: 'role', width: 100, render: renderRoleTag },
  { title: '职责', key: 'responsibilities', ellipsis: { tooltip: true } },
  { title: '联系电话', key: 'phone', width: 150 },
  { title: '操作', key: 'actions', width: 150, render: renderLeadershipActions }
]

// 工作小组表格列
const workTeamColumns = [
  { title: '姓名', key: 'name', width: 120 },
  { title: '职位', key: 'position', width: 150 },
  { title: '部门', key: 'department', width: 150 },
  { title: '角色', key: 'role', width: 100, render: renderRoleTag },
  { title: '职责', key: 'responsibilities', ellipsis: { tooltip: true } },
  { title: '联系电话', key: 'phone', width: 150 },
  { title: '操作', key: 'actions', width: 150, render: renderWorkTeamActions }
]

// 工作计划编辑表格列
const workPlanEditColumns = [
  { title: '阶段', key: 'stage_order', width: 80, render: renderStageOrder },
  { title: '阶段名称', key: 'stage', width: 200, render: renderStageName },
  { title: '工作内容', key: 'work_content', render: renderWorkContent },
  { title: '计划开始时间', key: 'planned_start_date', width: 150, render: renderPlannedStartDate },
  { title: '计划结束时间', key: 'planned_end_date', width: 150, render: renderPlannedEndDate },
  { title: '责任部门', key: 'responsible_department', width: 150, render: renderResponsibleDepartment },
  { title: '实际开始时间', key: 'actual_start_date', width: 150, render: renderActualStartDate },
  { title: '实际结束时间', key: 'actual_end_date', width: 150, render: renderActualEndDate },
  { title: '操作', key: 'actions', width: 100, render: renderWorkPlanActions }
]

// 培训记录表格列
const trainingColumns = [
  { title: '培训标题', key: 'title', width: 200 },
  { title: '培训日期', key: 'date', width: 120, render: renderTrainingDate },
  { title: '培训时长', key: 'duration', width: 100 },
  { title: '参与人数', key: 'participants', width: 100 },
  { title: '培训讲师', key: 'instructor', width: 120 },
  { title: '培训地点', key: 'location', width: 150 },
  { title: '操作', key: 'actions', width: 150, render: renderTrainingActions }
]
```

### 3.3 工作计划表UI设计

#### 3.3.1 主视图设计（两列网格布局）
```vue
<!-- 工作计划表主视图 -->
<div class="work-plan-grid">
  <div 
    v-for="(plan, index) in workPlans" 
    :key="plan.id"
    class="work-plan-card"
    :class="`stage-${plan.stage_order}`"
  >
    <div class="card-header">
      <div class="stage-icon" :class="`icon-${plan.stage_order}`">
        <TheIcon :icon="getStageIcon(plan.stage_order)" />
      </div>
      <div class="stage-info">
        <div class="stage-number">第{{ plan.stage_order }}阶段</div>
        <div class="stage-title">{{ plan.stage }}</div>
      </div>
    </div>
    <div class="card-content">
      <div class="work-content">{{ plan.work_content }}</div>
      <div class="stage-details">
        <div class="detail-row">
          <span class="detail-label">计划时间:</span>
          <span class="detail-value">{{ formatDateRange(plan.planned_start_date, plan.planned_end_date) }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">责任部门:</span>
          <span class="detail-value">{{ plan.responsible_department }}</span>
        </div>
        <div class="detail-row" v-if="plan.actual_start_date">
          <span class="detail-label">完成时间:</span>
          <span class="detail-value">{{ formatDateRange(plan.actual_start_date, plan.actual_end_date) }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
```

#### 3.3.2 编辑模态框设计
```vue
<!-- 编辑工作计划表模态框 -->
<n-modal
  v-model:show="showWorkPlanModal"
  preset="card"
  title="编辑工作计划表"
  size="huge"
  :bordered="false"
  style="width: 90%"
>
  <div class="work-plan-edit-container">
    <div class="edit-actions mb-4">
      <n-button type="primary" @click="addWorkPlanStage">
        <template #icon>
          <TheIcon icon="carbon:add" />
        </template>
        添加阶段
      </n-button>
    </div>
    
    <n-data-table
      :columns="workPlanEditColumns"
      :data="workPlanStages"
      :pagination="false"
      :bordered="true"
      class="work-plan-edit-table"
    />
    
    <div class="modal-actions mt-4">
      <n-space justify="end">
        <n-button @click="showWorkPlanModal = false">取消</n-button>
        <n-button type="primary" @click="saveWorkPlans">保存</n-button>
      </n-space>
    </div>
  </div>
</n-modal>
```

### 3.4 样式设计规范

#### 3.4.1 工作计划表网格样式
```css
.work-plan-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 20px;
  margin-top: 16px;
}

.work-plan-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border-left: 4px solid var(--stage-color);
}

.work-plan-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.stage-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 18px;
  margin-right: 12px;
}

.stage-number {
  font-size: 14px;
  color: #666;
  margin-bottom: 4px;
}

.stage-title {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 12px;
}

.work-content {
  font-size: 16px;
  color: #555;
  line-height: 1.6;
  margin-bottom: 16px;
}

.detail-row {
  display: flex;
  margin-bottom: 8px;
}

.detail-label {
  font-weight: 500;
  color: #666;
  min-width: 80px;
  margin-right: 8px;
}

.detail-value {
  color: #333;
  flex: 1;
}
```

#### 3.4.2 阶段颜色主题
```css
/* 阶段1-10的颜色主题 */
.stage-1 { --stage-color: #ff6b6b; }
.stage-2 { --stage-color: #4ecdc4; }
.stage-3 { --stage-color: #45b7d1; }
.stage-4 { --stage-color: #96ceb4; }
.stage-5 { --stage-color: #feca57; }
.stage-6 { --stage-color: #ff9ff3; }
.stage-7 { --stage-color: #54a0ff; }
.stage-8 { --stage-color: #5f27cd; }
.stage-9 { --stage-color: #00d2d3; }
.stage-10 { --stage-color: #ff9f43; }

.icon-1 { background: #ff6b6b; }
.icon-2 { background: #4ecdc4; }
.icon-3 { background: #45b7d1; }
.icon-4 { background: #96ceb4; }
.icon-5 { background: #feca57; }
.icon-6 { background: #ff9ff3; }
.icon-7 { background: #54a0ff; }
.icon-8 { background: #5f27cd; }
.icon-9 { background: #00d2d3; }
.icon-10 { background: #ff9f43; }
```

### 3.5 功能方法实现

#### 3.5.1 数据获取方法
```javascript
// 获取领导小组数据
const fetchLeadershipTeam = async () => {
  try {
    leadershipLoading.value = true
    const response = await pcbApi.planning.getLeadershipTeam(enterpriseId.value)
    leadershipTeam.value = response.data.items || []
  } catch (error) {
    console.error('获取领导小组失败:', error)
    message.error('获取领导小组失败')
  } finally {
    leadershipLoading.value = false
  }
}

// 获取工作小组数据
const fetchWorkTeam = async () => {
  try {
    workTeamLoading.value = true
    const response = await pcbApi.planning.getWorkTeam(enterpriseId.value)
    workTeam.value = response.data.items || []
  } catch (error) {
    console.error('获取工作小组失败:', error)
    message.error('获取工作小组失败')
  } finally {
    workTeamLoading.value = false
  }
}

// 获取工作计划数据
const fetchWorkPlans = async () => {
  try {
    workPlanLoading.value = true
    const response = await pcbApi.planning.getWorkPlans(enterpriseId.value)
    workPlans.value = response.data.items || []
    workPlanStages.value = [...workPlans.value] // 创建可编辑副本
  } catch (error) {
    console.error('获取工作计划失败:', error)
    message.error('获取工作计划失败')
  } finally {
    workPlanLoading.value = false
  }
}

// 获取培训记录数据
const fetchTrainingRecords = async () => {
  try {
    trainingLoading.value = true
    const response = await pcbApi.planning.getTrainingRecords(enterpriseId.value)
    trainingRecords.value = response.data.items || []
  } catch (error) {
    console.error('获取培训记录失败:', error)
    message.error('获取培训记录失败')
  } finally {
    trainingLoading.value = false
  }
}
```

#### 3.5.2 数据保存方法
```javascript
// 保存领导小组成员
const saveLeadershipMember = async () => {
  try {
    await pcbApi.planning.addLeadershipMember(enterpriseId.value, leadershipForm.value)
    message.success('添加成功')
    showAddLeadershipModal.value = false
    resetLeadershipForm()
    await fetchLeadershipTeam()
  } catch (error) {
    console.error('添加领导小组成员失败:', error)
    message.error('添加失败')
  }
}

// 保存工作小组成员
const saveWorkTeamMember = async () => {
  try {
    await pcbApi.planning.addWorkTeamMember(enterpriseId.value, workTeamForm.value)
    message.success('添加成功')
    showAddWorkTeamModal.value = false
    resetWorkTeamForm()
    await fetchWorkTeam()
  } catch (error) {
    console.error('添加工作小组成员失败:', error)
    message.error('添加失败')
  }
}

// 保存工作计划
const saveWorkPlans = async () => {
  try {
    await pcbApi.planning.updateWorkPlans(enterpriseId.value, workPlanStages.value)
    message.success('保存成功')
    showWorkPlanModal.value = false
    await fetchWorkPlans()
  } catch (error) {
    console.error('保存工作计划失败:', error)
    message.error('保存失败')
  }
}

// 保存培训记录
const saveTraining = async () => {
  try {
    const formData = new FormData()
    Object.keys(trainingForm.value).forEach(key => {
      if (trainingForm.value[key] !== null && trainingForm.value[key] !== '') {
        formData.append(key, trainingForm.value[key])
      }
    })
    
    // 添加图片文件
    meetingImages.value.forEach((file, index) => {
      formData.append(`images[${index}]`, file)
    })
    
    await pcbApi.planning.addTrainingRecord(enterpriseId.value, formData)
    message.success('添加成功')
    showAddTrainingModal.value = false
    resetTrainingForm()
    await fetchTrainingRecords()
  } catch (error) {
    console.error('添加培训记录失败:', error)
    message.error('添加失败')
  }
}
```

#### 3.5.3 工作计划表编辑功能
```javascript
// 添加新阶段
const addWorkPlanStage = () => {
  const newStage = {
    id: null,
    stage_order: workPlanStages.value.length + 1,
    stage: '',
    work_content: '',
    planned_start_date: null,
    planned_end_date: null,
    responsible_department: '',
    actual_start_date: null,
    actual_end_date: null
  }
  workPlanStages.value.push(newStage)
}

// 删除阶段
const deleteWorkPlanStage = (index) => {
  workPlanStages.value.splice(index, 1)
  // 重新排序
  reorderStages()
}

// 重新排序阶段
const reorderStages = () => {
  workPlanStages.value.forEach((stage, index) => {
    stage.stage_order = index + 1
  })
}

// 获取阶段图标
const getStageIcon = (stageOrder) => {
  const icons = [
    'carbon:settings', 'carbon:search', 'carbon:document', 'carbon:idea',
    'carbon:checkmark', 'carbon:play', 'carbon:renew', 'carbon:document-attachment',
    'carbon:send', 'carbon:location'
  ]
  return icons[stageOrder - 1] || 'carbon:circle'
}

// 格式化日期范围
const formatDateRange = (startDate, endDate) => {
  if (!startDate || !endDate) return '-'
  const start = new Date(startDate).toLocaleDateString()
  const end = new Date(endDate).toLocaleDateString()
  return `${start} - ${end}`
}
```

### 3.6 渲染函数实现

#### 3.6.1 表格渲染函数
```javascript
import { h } from 'vue'
import { NInput, NDatePicker, NInputNumber, NButton, NTag, NSpace } from 'naive-ui'

// 阶段顺序渲染
const renderStageOrder = (row, index) => {
  return h('div', { class: 'stage-order-display' }, [
    h('span', { class: 'stage-order-text' }, `第${row.stage_order}阶段`)
  ])
}

// 阶段名称渲染
const renderStageName = (row, index) => {
  return h(NInput, {
    value: row.stage,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].stage = value
    },
    placeholder: '请输入阶段名称'
  })
}

// 工作内容渲染
const renderWorkContent = (row, index) => {
  return h(NInput, {
    value: row.work_content,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].work_content = value
    },
    type: 'textarea',
    placeholder: '请输入工作内容'
  })
}

// 计划开始时间渲染
const renderPlannedStartDate = (row, index) => {
  return h(NDatePicker, {
    value: row.planned_start_date,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].planned_start_date = value
    },
    type: 'date',
    placeholder: '选择开始时间'
  })
}

// 计划结束时间渲染
const renderPlannedEndDate = (row, index) => {
  return h(NDatePicker, {
    value: row.planned_end_date,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].planned_end_date = value
    },
    type: 'date',
    placeholder: '选择结束时间'
  })
}

// 责任部门渲染
const renderResponsibleDepartment = (row, index) => {
  return h(NInput, {
    value: row.responsible_department,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].responsible_department = value
    },
    placeholder: '请输入责任部门'
  })
}

// 实际开始时间渲染
const renderActualStartDate = (row, index) => {
  return h(NDatePicker, {
    value: row.actual_start_date,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].actual_start_date = value
    },
    type: 'date',
    placeholder: '选择开始时间'
  })
}

// 实际结束时间渲染
const renderActualEndDate = (row, index) => {
  return h(NDatePicker, {
    value: row.actual_end_date,
    'onUpdate:value': (value) => {
      workPlanStages.value[index].actual_end_date = value
    },
    type: 'date',
    placeholder: '选择结束时间'
  })
}

// 操作按钮渲染
const renderWorkPlanActions = (row, index) => {
  return h(NSpace, [
    h(NButton, {
      size: 'small',
      type: 'error',
      onClick: () => deleteWorkPlanStage(index)
    }, { default: () => '删除' })
  ])
}

// 角色标签渲染
const renderRoleTag = (row) => {
  const roleConfig = {
    '组长': { type: 'success', text: '组长' },
    '副组长': { type: 'info', text: '副组长' },
    '成员': { type: 'default', text: '成员' }
  }
  const config = roleConfig[row.role] || { type: 'default', text: row.role }
  return h(NTag, { type: config.type }, { default: () => config.text })
}
```

### 3.7 宣传与培训模块设计

#### 3.7.1 培训记录卡片设计
```vue
<!-- 宣传与培训模块 -->
<n-card class="mb-4 training-container">
  <template #header>
    <div class="card-header">
      <div class="header-left">
        <TheIcon icon="carbon:education" class="header-icon" />
        <span class="header-title">宣传与培训</span>
      </div>
      <div class="header-actions">
        <!-- 会议图片上传 -->
        <n-upload
          :file-list="meetingImages"
          @change="handleMeetingImageChange"
          @remove="handleMeetingImageRemove"
          :max="5"
          accept="image/*"
          class="meeting-image-upload"
        >
          <n-button size="small" type="info">
            <template #icon>
              <TheIcon icon="carbon:camera" />
            </template>
            上传会议图片
          </n-button>
        </n-upload>
        
        <n-button type="primary" @click="showAddTrainingModal = true">
          <template #icon>
            <TheIcon icon="carbon:add" />
          </template>
          添加培训记录
        </n-button>
      </div>
    </div>
  </template>
  
  <div class="training-records">
    <div 
      v-for="record in trainingRecords" 
      :key="record.id"
      class="training-card"
    >
      <div class="training-header">
        <h3 class="training-title">{{ record.title }}</h3>
        <div class="training-meta">
          <span class="training-date">{{ formatDate(record.date) }}</span>
          <span class="training-duration">{{ record.duration }}分钟</span>
          <span class="training-participants">{{ record.participants }}人参与</span>
        </div>
      </div>
      
      <div class="training-content">
        <p class="training-description">{{ record.content }}</p>
        <div class="training-details">
          <div class="detail-item">
            <span class="detail-label">培训讲师:</span>
            <span class="detail-value">{{ record.instructor }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">培训地点:</span>
            <span class="detail-value">{{ record.location }}</span>
          </div>
        </div>
      </div>
      
      <div class="training-actions">
        <n-space>
          <n-button size="small" @click="editTraining(record)">编辑</n-button>
          <n-button size="small" type="error" @click="deleteTraining(record.id)">删除</n-button>
        </n-space>
      </div>
    </div>
  </div>
</n-card>
```

#### 3.7.2 培训记录样式
```css
.training-records {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 20px;
  margin-top: 16px;
}

.training-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border-left: 4px solid #4ecdc4;
}

.training-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.training-header {
  margin-bottom: 16px;
}

.training-title {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin: 0 0 8px 0;
}

.training-meta {
  display: flex;
  gap: 16px;
  font-size: 14px;
  color: #666;
}

.training-content {
  margin-bottom: 16px;
}

.training-description {
  color: #555;
  line-height: 1.6;
  margin-bottom: 12px;
}

.training-details {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.detail-item {
  display: flex;
}

.detail-label {
  font-weight: 500;
  color: #666;
  min-width: 80px;
  margin-right: 8px;
}

.detail-value {
  color: #333;
  flex: 1;
}

.training-actions {
  border-top: 1px solid #f0f0f0;
  padding-top: 12px;
}
```

### 3.8 图片上传功能

#### 3.8.1 图片上传处理
```javascript
// 处理会议图片上传
const handleMeetingImageChange = (options) => {
  const { fileList } = options
  meetingImages.value = fileList.map(file => file.file)
}

// 处理会议图片删除
const handleMeetingImageRemove = (options) => {
  const { fileList } = options
  meetingImages.value = fileList.map(file => file.file)
}

// 格式化日期
const formatDate = (date) => {
  if (!date) return '-'
  return new Date(date).toLocaleDateString('zh-CN')
}
```

### 3.9 表单验证规则

#### 3.9.1 领导小组表单验证
```javascript
const leadershipRules = {
  name: [
    { required: true, message: '请输入姓名', trigger: 'blur' }
  ],
  role: [
    { required: true, message: '请选择角色', trigger: 'change' }
  ],
  position: [
    { required: true, message: '请输入职位', trigger: 'blur' }
  ],
  department: [
    { required: true, message: '请输入部门', trigger: 'blur' }
  ]
}
```

#### 3.9.2 工作小组表单验证
```javascript
const workTeamRules = {
  name: [
    { required: true, message: '请输入姓名', trigger: 'blur' }
  ],
  role: [
    { required: true, message: '请选择角色', trigger: 'change' }
  ],
  position: [
    { required: true, message: '请输入职位', trigger: 'blur' }
  ],
  department: [
    { required: true, message: '请输入部门', trigger: 'blur' }
  ]
}
```

#### 3.9.3 培训记录表单验证
```javascript
const trainingRules = {
  title: [
    { required: true, message: '请输入培训标题', trigger: 'blur' }
  ],
  date: [
    { required: true, message: '请选择培训日期', trigger: 'change' }
  ],
  content: [
    { required: true, message: '请输入培训内容', trigger: 'blur' }
  ],
  instructor: [
    { required: true, message: '请输入培训讲师', trigger: 'blur' }
  ],
  location: [
    { required: true, message: '请输入培训地点', trigger: 'blur' }
  ]
}
```

### 3.10 选项数据

#### 3.10.1 角色选项
```javascript
const leadershipRoleOptions = [
  { label: '组长', value: '组长' },
  { label: '副组长', value: '副组长' },
  { label: '成员', value: '成员' }
]

const workTeamRoleOptions = [
  { label: '组长', value: '组长' },
  { label: '副组长', value: '副组长' },
  { label: '成员', value: '成员' }
]
```

### 3.11 生命周期钩子

#### 3.11.1 组件初始化
```javascript
onMounted(async () => {
  await Promise.all([
    fetchLeadershipTeam(),
    fetchWorkTeam(),
    fetchWorkPlans(),
    fetchTrainingRecords()
  ])
})
```

## 4. API服务层设计

### 4.1 API服务文件
文件位置: `web/src/api/pcb.js`

```javascript
import { request } from '@/utils'

// PCB筹划与组织API
export const pcbPlanningApi = {
  // 获取审核领导小组
  getLeadershipTeam: (enterpriseId) => 
    request.get(`/api/v1/pcb/enterprise/${enterpriseId}/leadership-team`),
  
  // 添加审核领导小组成员
  addLeadershipMember: (enterpriseId, data) => 
    request.post(`/api/v1/pcb/enterprise/${enterpriseId}/leadership-team`, data),
  
  // 更新审核领导小组成员
  updateLeadershipMember: (enterpriseId, memberId, data) => 
    request.put(`/api/v1/pcb/enterprise/${enterpriseId}/leadership-team/${memberId}`, data),
  
  // 删除审核领导小组成员
  deleteLeadershipMember: (enterpriseId, memberId) => 
    request.delete(`/api/v1/pcb/enterprise/${enterpriseId}/leadership-team/${memberId}`),
  
  // 获取清洁生产工作小组
  getWorkTeam: (enterpriseId) => 
    request.get(`/api/v1/pcb/enterprise/${enterpriseId}/work-team`),
  
  // 添加清洁生产工作小组成员
  addWorkTeamMember: (enterpriseId, data) => 
    request.post(`/api/v1/pcb/enterprise/${enterpriseId}/work-team`, data),
  
  // 更新清洁生产工作小组成员
  updateWorkTeamMember: (enterpriseId, memberId, data) => 
    request.put(`/api/v1/pcb/enterprise/${enterpriseId}/work-team/${memberId}`, data),
  
  // 删除清洁生产工作小组成员
  deleteWorkTeamMember: (enterpriseId, memberId) => 
    request.delete(`/api/v1/pcb/enterprise/${enterpriseId}/work-team/${memberId}`),
  
  // 获取工作计划表
  getWorkPlans: (enterpriseId) => 
    request.get(`/api/v1/pcb/enterprise/${enterpriseId}/work-plans`),
  
  // 更新工作计划表
  updateWorkPlans: (enterpriseId, data) => 
    request.put(`/api/v1/pcb/enterprise/${enterpriseId}/work-plans`, data),
  
  // 获取培训记录
  getTrainingRecords: (enterpriseId) => 
    request.get(`/api/v1/pcb/enterprise/${enterpriseId}/training-records`),
  
  // 添加培训记录
  addTrainingRecord: (enterpriseId, data) => 
    request.post(`/api/v1/pcb/enterprise/${enterpriseId}/training-records`, data),
  
  // 更新培训记录
  updateTrainingRecord: (enterpriseId, recordId, data) => 
    request.put(`/api/v1/pcb/enterprise/${enterpriseId}/training-records/${recordId}`, data),
  
  // 删除培训记录
  deleteTrainingRecord: (enterpriseId, recordId) => 
    request.delete(`/api/v1/pcb/enterprise/${enterpriseId}/training-records/${recordId}`)
}
```

## 5. 实施步骤

### 5.1 第一步：恢复基础组件结构
1. 创建 `planning.vue` 文件的基础模板结构
2. 实现四个主要模块的卡片布局
3. 添加基础的响应式数据定义

### 5.2 第二步：实现领导小组模块
1. 实现领导小组的数据表格
2. 添加成员添加/编辑/删除功能
3. 实现表单验证和提交逻辑

### 5.3 第三步：实现工作小组模块
1. 复制领导小组的实现逻辑
2. 调整相关的API调用和数据处理
3. 确保UI风格一致

### 5.4 第四步：实现工作计划表模块
1. 实现两列网格布局的主视图
2. 创建编辑模态框和表格
3. 实现阶段编辑、添加、删除功能
4. 添加阶段图标和颜色主题

### 5.5 第五步：实现宣传与培训模块
1. 实现培训记录的卡片布局
2. 添加图片上传功能
3. 实现培训记录的增删改查

### 5.6 第六步：样式优化和测试
1. 完善所有组件的样式
2. 测试所有功能的交互
3. 优化用户体验

## 6. 注意事项

### 6.1 前后端解耦
- 所有数据通过API获取，不直接操作数据库
- 使用标准的HTTP状态码和错误处理
- 实现完整的错误提示和加载状态

### 6.2 数据一致性
- 确保前端显示的数据与数据库一致
- 实现数据的实时更新和同步
- 处理并发操作的数据冲突

### 6.3 用户体验
- 提供清晰的加载状态提示
- 实现友好的错误提示
- 确保操作的响应性和流畅性

### 6.4 代码质量
- 遵循Vue 3 Composition API最佳实践
- 实现组件的可复用性和可维护性
- 添加适当的注释和文档

## 7. 总结

本恢复方案提供了完整的PCB筹划与组织前端功能实现指南，包括：

1. **完整的组件结构设计** - 四个主要功能模块
2. **详细的数据模型定义** - 响应式数据和表单结构
3. **丰富的UI交互设计** - 表格、模态框、卡片布局
4. **完整的API集成方案** - 前后端数据交互
5. **详细的样式规范** - 现代化、简约的设计风格
6. **分步实施指南** - 有序的功能实现步骤

通过按照本方案实施，可以完全恢复PCB筹划与组织模块的前端功能，并确保与新建数据库的完美集成。
