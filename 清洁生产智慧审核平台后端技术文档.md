# æ¸…æ´ç”Ÿäº§æ™ºæ…§å®¡æ ¸å¹³å°åç«¯æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æ¸…æ´ç”Ÿäº§æ™ºæ…§å®¡æ ¸å¹³å°åç«¯åŸºäº FastAPI æ¡†æ¶æ„å»ºï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œä¸ºå‰ç«¯æä¾›é«˜æ€§èƒ½çš„ RESTful API æœåŠ¡ã€‚ç³»ç»Ÿæ”¯æŒå¤šè¡Œä¸šæ¸…æ´ç”Ÿäº§å®¡æ ¸ç®¡ç†ï¼ŒåŒ…æ‹¬ PCBã€é’¢é“ã€ç»ç’ƒã€ç„¦åŒ–ã€å®¶å…·ã€æ±½ä¿®ç­‰è¡Œä¸šï¼Œå®ç°äº†å®Œæ•´çš„å®¡æ ¸æµç¨‹ç®¡ç†ã€æ•°æ®åˆ†æå’ŒæŠ¥å‘Šç”ŸæˆåŠŸèƒ½ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **Webæ¡†æ¶**: FastAPI 0.111.0
- **æ•°æ®åº“ORM**: Tortoise ORM 0.23.0
- **æ•°æ®åº“**: SQLite (æ”¯æŒ MySQL/PostgreSQL)
- **è®¤è¯æˆæƒ**: JWT + RBAC
- **æ•°æ®éªŒè¯**: Pydantic 2.10.5
- **å¼‚æ­¥æ”¯æŒ**: asyncio + uvicorn
- **æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆ OpenAPI/Swagger æ–‡æ¡£

### æ¶æ„è®¾è®¡åŸåˆ™

1. **åˆ†å±‚æ¶æ„**: æ§åˆ¶å™¨å±‚ â†’ ä¸šåŠ¡é€»è¾‘å±‚ â†’ æ•°æ®è®¿é—®å±‚
2. **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ FastAPI çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿ
3. **å¼‚æ­¥ä¼˜å…ˆ**: å…¨é¢é‡‡ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼
4. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ Pydantic è¿›è¡Œä¸¥æ ¼çš„æ•°æ®éªŒè¯
5. **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„ç»†ç²’åº¦æƒé™ç®¡ç†

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“é…ç½®

ç³»ç»Ÿæ”¯æŒå¤šç§æ•°æ®åº“ï¼Œé»˜è®¤ä½¿ç”¨ SQLiteï¼š

```python
TORTOISE_ORM = {
    "connections": {
        "sqlite": {
            "engine": "tortoise.backends.sqlite",
            "credentials": {"file_path": "db.sqlite3"}
        }
    },
    "apps": {
        "models": {
            "models": ["app.models", "aerich.models"],
            "default_connection": "sqlite"
        }
    }
}
```

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. ç³»ç»Ÿç®¡ç†æ¨¡å—

**ç”¨æˆ·ç®¡ç† (User)**

- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€è§’è‰²å…³è”ã€æƒé™æ§åˆ¶
- æ”¯æŒè¶…çº§ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·

**è§’è‰²ç®¡ç† (Role)**

- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- æ”¯æŒè§’è‰²ä¸APIæƒé™ã€èœå•æƒé™çš„å…³è”

**èœå•ç®¡ç† (Menu)**

- åŠ¨æ€èœå•é…ç½®
- æ”¯æŒå¤šçº§èœå•ç»“æ„å’Œæƒé™æ§åˆ¶

**APIç®¡ç† (Api)**

- è‡ªåŠ¨æ‰«æå’Œæ³¨å†ŒAPIæ¥å£
- æ”¯æŒç»†ç²’åº¦çš„APIæƒé™æ§åˆ¶

#### 2. PCBè¡Œä¸šå®¡æ ¸æ¨¡å—

**ä¼ä¸šä¿¡æ¯ (PCBEnterprise)**

```python
class PCBEnterprise(BaseModel, TimestampMixin):
    name = fields.CharField(max_length=200, description="ä¼ä¸šåç§°")
    unified_social_credit_code = fields.CharField(max_length=50)
    region = fields.CharField(max_length=100, description="åœ°å¸‚")
    district = fields.CharField(max_length=100, description="åŒºå¿")
    audit_status = fields.CharField(max_length=50, default="pending")
    current_step = fields.IntField(default=0)
    is_deleted = fields.BooleanField(default=False)
```

**å®¡æ ¸æŒ‡æ ‡ (PCBIndicator)**

- 64é¡¹PCBæ¸…æ´ç”Ÿäº§å®¡æ ¸æŒ‡æ ‡
- æ”¯æŒå®šæ€§ã€å®šé‡ã€é™å®šæ€§æŒ‡æ ‡åˆ†ç±»
- åŒ…å«è¯„çº§æ ‡å‡†å’Œæƒé‡é…ç½®

**å®¡æ ¸ç»“æœ (PCBAuditResult)**

- ä¼ä¸šæŒ‡æ ‡å®¡æ ¸ç»“æœå­˜å‚¨
- æ”¯æŒæ‰‹åŠ¨è°ƒæ•´å’Œè‡ªåŠ¨è®¡ç®—
- åŒ…å«æ–¹æ¡ˆé€‰æ‹©è®°å½•

**æ¸…æ´ç”Ÿäº§æ–¹æ¡ˆ (PCBScheme)**

- 130é¡¹æ¸…æ´ç”Ÿäº§æ”¹è¿›æ–¹æ¡ˆ
- åŒ…å«ç»æµæ•ˆç›Šå’Œç¯å¢ƒæ•ˆç›Šåˆ†æ
- æ”¯æŒæ–¹æ¡ˆä¸æŒ‡æ ‡çš„å…³è”

#### 3. ç­¹åˆ’ä¸ç»„ç»‡æ¨¡å—

**é¢†å¯¼å°ç»„ (PCBLeadershipTeam)**

- å®¡æ ¸é¢†å¯¼å°ç»„æˆå‘˜ç®¡ç†
- åŒ…å«èŒè´£åˆ†å·¥å’Œè”ç³»æ–¹å¼

**å·¥ä½œå°ç»„ (PCBWorkTeam)**

- æ¸…æ´ç”Ÿäº§å·¥ä½œå°ç»„æˆå‘˜
- æ”¯æŒè§’è‰²å’ŒèŒè´£é…ç½®

**å·¥ä½œè®¡åˆ’ (PCBWorkPlan)**

- å®¡æ ¸å·¥ä½œè®¡åˆ’åˆ¶å®š
- æ”¯æŒé˜¶æ®µåˆ’åˆ†å’Œæ—¶é—´ç®¡ç†

**åŸ¹è®­è®°å½• (PCBTrainingRecord)**

- åŸ¹è®­æ´»åŠ¨è®°å½•ç®¡ç†
- æ”¯æŒå›¾ç‰‡é™„ä»¶ä¸Šä¼ 

#### 4. ç”Ÿäº§æ•°æ®æ¨¡å—

**ç”Ÿäº§æƒ…å†µ (PCBProductOutput)**

- äº§å“äº§é‡ã€åˆæ ¼ç‡ã€äº§å€¼æ•°æ®
- æ”¯æŒå¤šå¹´åº¦æ•°æ®å¯¹æ¯”

**èµ„æºæ¶ˆè€— (PCBResourceConsumptionRecord)**

- ç”¨æ°´ã€ç”¨ç”µã€å¤©ç„¶æ°”æ¶ˆè€—è®°å½•
- æ”¯æŒåˆ†ç±»ç»Ÿè®¡å’Œæ±‡æ€»åˆ†æ

**æ±¡æŸ“é˜²æ²» (PCBPollutionControl)**

- åºŸæ°´ã€åºŸæ°”äº§ç”Ÿåˆ†æ
- æ±¡æŸ“ç‰©æ’æ”¾ç›‘æµ‹æ•°æ®

## ğŸ”Œ APIæ¥å£è®¾è®¡

### æ¥å£è§„èŒƒ

æ‰€æœ‰APIéµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼š

- **åŸºç¡€è·¯å¾„**: `/api/v1`
- **è®¤è¯æ–¹å¼**: JWT Token
- **æ•°æ®æ ¼å¼**: JSON
- **çŠ¶æ€ç **: æ ‡å‡†HTTPçŠ¶æ€ç 
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

### æ ¸å¿ƒAPIæ¨¡å—

#### 1. ç³»ç»Ÿç®¡ç†API

**ç”¨æˆ·ç®¡ç†**

```http
GET    /api/v1/user              # è·å–ç”¨æˆ·åˆ—è¡¨
POST   /api/v1/user              # åˆ›å»ºç”¨æˆ·
GET    /api/v1/user/{id}         # è·å–ç”¨æˆ·è¯¦æƒ…
PUT    /api/v1/user/{id}         # æ›´æ–°ç”¨æˆ·
DELETE /api/v1/user/{id}         # åˆ é™¤ç”¨æˆ·
```

**è§’è‰²ç®¡ç†**

```http
GET    /api/v1/role              # è·å–è§’è‰²åˆ—è¡¨
POST   /api/v1/role              # åˆ›å»ºè§’è‰²
PUT    /api/v1/role/{id}         # æ›´æ–°è§’è‰²
DELETE /api/v1/role/{id}         # åˆ é™¤è§’è‰²
```

#### 2. PCBå®¡æ ¸API

**ä¼ä¸šç®¡ç†**

```http
GET    /api/v1/pcb/enterprise                    # ä¼ä¸šåˆ—è¡¨
POST   /api/v1/pcb/enterprise                    # åˆ›å»ºä¼ä¸š
GET    /api/v1/pcb/enterprise/{id}               # ä¼ä¸šè¯¦æƒ…
PUT    /api/v1/pcb/enterprise/{id}               # æ›´æ–°ä¼ä¸š
DELETE /api/v1/pcb/enterprise/{id}               # åˆ é™¤ä¼ä¸š
```

**å®¡æ ¸æµç¨‹**

```http
GET    /api/v1/pcb/enterprise/{id}/pre-audit     # é¢„å®¡æ ¸æ•°æ®
POST   /api/v1/pcb/enterprise/{id}/pre-audit     # ä¿å­˜é¢„å®¡æ ¸
GET    /api/v1/pcb/enterprise/{id}/audit         # å®¡æ ¸ç»“æœ
PUT    /api/v1/pcb/enterprise/{id}/audit/indicator/{indicator_id}  # æ›´æ–°æŒ‡æ ‡
POST   /api/v1/pcb/enterprise/{id}/audit/batch   # æ‰¹é‡æ›´æ–°
```

**æ–¹æ¡ˆç®¡ç†**

```http
GET    /api/v1/pcb/scheme                        # æ–¹æ¡ˆåˆ—è¡¨
POST   /api/v1/pcb/scheme                        # åˆ›å»ºæ–¹æ¡ˆ
GET    /api/v1/pcb/scheme/{id}                   # æ–¹æ¡ˆè¯¦æƒ…
PUT    /api/v1/pcb/scheme/{id}                   # æ›´æ–°æ–¹æ¡ˆ
DELETE /api/v1/pcb/scheme/{id}                   # åˆ é™¤æ–¹æ¡ˆ
```

#### 3. ç­¹åˆ’ç»„ç»‡API

**å›¢é˜Ÿç®¡ç†**

```http
GET    /api/v1/pcb/enterprise/{id}/leadership-team    # é¢†å¯¼å°ç»„
POST   /api/v1/pcb/enterprise/{id}/leadership-team    # æ·»åŠ æˆå‘˜
GET    /api/v1/pcb/enterprise/{id}/work-team          # å·¥ä½œå°ç»„
POST   /api/v1/pcb/enterprise/{id}/work-team          # æ·»åŠ æˆå‘˜
```

**å·¥ä½œè®¡åˆ’**

```http
GET    /api/v1/pcb/enterprise/{id}/work-plans         # å·¥ä½œè®¡åˆ’
POST   /api/v1/pcb/enterprise/{id}/work-plans         # åˆ›å»ºè®¡åˆ’
PUT    /api/v1/pcb/enterprise/{id}/work-plans         # æ›´æ–°è®¡åˆ’
```

**åŸ¹è®­è®°å½•**

```http
GET    /api/v1/pcb/enterprise/{id}/training-records   # åŸ¹è®­è®°å½•
POST   /api/v1/pcb/enterprise/{id}/training-records   # åˆ›å»ºè®°å½•
PUT    /api/v1/pcb/enterprise/{id}/training-records/{id}  # æ›´æ–°è®°å½•
```

#### 4. ç”Ÿäº§æ•°æ®API

**ç”Ÿäº§æƒ…å†µ**

```http
GET    /api/v1/pcb/enterprise/{id}/production-data     # ç”Ÿäº§æ•°æ®
POST   /api/v1/pcb/enterprise/{id}/production-data     # ä¿å­˜æ•°æ®
PUT    /api/v1/pcb/enterprise/{id}/production-data     # æ›´æ–°æ•°æ®
```

**èµ„æºæ¶ˆè€—**

```http
GET    /api/v1/resource-consumption/enterprise/{id}/all-data    # èµ„æºæ•°æ®
POST   /api/v1/resource-consumption/enterprise/{id}/all-data    # ä¿å­˜æ•°æ®
```

**æ±¡æŸ“é˜²æ²»**

```http
GET    /api/v1/pollution-control/enterprise/{id}/all-data       # æ±¡æŸ“æ•°æ®
POST   /api/v1/pollution-control/enterprise/{id}/all-data       # ä¿å­˜æ•°æ®
```

### APIå“åº”æ ¼å¼

**æˆåŠŸå“åº”**

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®
  }
}
```

**é”™è¯¯å“åº”**

```json
{
  "code": 400,
  "message": "é”™è¯¯æè¿°",
  "detail": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
}
```

## ğŸ” è®¤è¯ä¸æˆæƒ

### JWTè®¤è¯æœºåˆ¶

**Tokenç”Ÿæˆ**

```python
def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.JWT_ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.JWT_ALGORITHM)
    return encoded_jwt
```

**TokenéªŒè¯**

```python
async def is_authed(token: str = Header(..., description="tokenéªŒè¯")):
    try:
        decode_data = jwt.decode(token, settings.SECRET_KEY, algorithms=settings.JWT_ALGORITHM)
        user_id = decode_data.get("user_id")
        user = await User.filter(id=user_id).first()
        if not user:
            raise HTTPException(status_code=401, detail="Authentication failed")
        return user
    except jwt.DecodeError:
        raise HTTPException(status_code=401, detail="æ— æ•ˆçš„Token")
```

### RBACæƒé™æ§åˆ¶

**æƒé™éªŒè¯**

```python
async def has_permission(request: Request, current_user: User = Depends(AuthControl.is_authed)):
    if current_user.is_superuser:
        return
  
    method = request.method
    path = request.url.path
    roles: list[Role] = await current_user.roles
  
    # æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™
    apis = [await role.apis for role in roles]
    permission_apis = list(set((api.method, api.path) for api in sum(apis, [])))
  
    # ç²¾ç¡®åŒ¹é…å’Œè·¯å¾„å‚æ•°åŒ¹é…
    if (method, path) in permission_apis:
        return
  
    for api_method, api_path in permission_apis:
        if api_method == method and _match_path(api_path, path):
            return
          
    raise HTTPException(status_code=403, detail=f"Permission denied method:{method} path:{path}")
```

## ğŸ”„ å‰åç«¯äº¤äº’æœºåˆ¶

### HTTPå®¢æˆ·ç«¯é…ç½®

**è¯·æ±‚æ‹¦æˆªå™¨**

```javascript
export function reqResolve(config) {
  const token = getToken()
  if (token) {
    config.headers.token = token
    config.headers.Authorization = `Bearer ${token}`
  }
  
  // è‡ªåŠ¨è®¾ç½®Content-Type
  const method = (config.method || 'get').toLowerCase()
  const isWrite = method === 'post' || method === 'put' || method === 'patch'
  if (isWrite && !config.headers['Content-Type']) {
    config.headers['Content-Type'] = 'application/json'
  }
  
  return config
}
```

**å“åº”æ‹¦æˆªå™¨**

```javascript
export function resResolve(response) {
  const { data } = response
  
  if (data.code !== 200) {
    const code = data.code
    const message = resolveResError(code, data.msg)
    window.$message?.error(message)
    return Promise.reject({ code, message, data })
  }
  
  return Promise.resolve(data)
}
```

### APIæœåŠ¡å±‚è®¾è®¡

**ç»Ÿä¸€APIå¯¹è±¡**

```javascript
export const pcbApi = {
  enterprise: pcbEnterpriseApi,      // ä¼ä¸šç®¡ç†
  indicator: pcbIndicatorApi,        // æŒ‡æ ‡ç®¡ç†
  audit: pcbAuditApi,               // å®¡æ ¸ç»“æœ
  preAudit: pcbPreAuditApi,         // é¢„å®¡æ ¸æ•°æ®
  scheme: pcbSchemeApi,             // æ–¹æ¡ˆåº“
  enterpriseScheme: pcbEnterpriseSchemeApi, // ä¼ä¸šæ–¹æ¡ˆ
  report: pcbReportApi,             // å®¡æ ¸æŠ¥å‘Š
  planning: pcbPlanningApi,         // ç­¹åˆ’ç»„ç»‡
  production: pcbProductionApi,     // ç”Ÿäº§æ•°æ®
  resourceConsumption: resourceConsumptionApi, // èµ„æºæ¶ˆè€—
  pollutionControl: pcbPollutionControlApi    // æ±¡æŸ“é˜²æ²»
}
```

### æ•°æ®æµè½¬æœºåˆ¶

```
å‰ç«¯ç»„ä»¶ â†’ APIæœåŠ¡å±‚ â†’ HTTPæ‹¦æˆªå™¨ â†’ åç«¯FastAPI â†’ ä¸šåŠ¡æ§åˆ¶å™¨ â†’ æ•°æ®æ¨¡å‹ â†’ æ•°æ®åº“
    â†“           â†“           â†“           â†“           â†“           â†“         â†“
Vueç»„ä»¶ â†’ pcbApi â†’ axios â†’ /api/v1/pcb/* â†’ Controller â†’ Model â†’ SQLite
```

## ğŸ­ ä¸šåŠ¡åŠŸèƒ½å®ç°

### 1. ä¼ä¸šå®¡æ ¸æµç¨‹ç®¡ç†

**å…­æ­¥å®¡æ ¸æµç¨‹**

1. **ä¼ä¸šåŸºæœ¬ä¿¡æ¯** - ä¼ä¸šæ³¨å†Œå’ŒåŸºç¡€ä¿¡æ¯ç®¡ç†
2. **ç­¹åˆ’ä¸ç»„ç»‡** - å®¡æ ¸å›¢é˜Ÿç»„å»ºå’Œå·¥ä½œè®¡åˆ’åˆ¶å®š
3. **é¢„å®¡æ ¸** - ä¼ä¸šæ•°æ®æ”¶é›†å’Œåˆæ­¥è¯„ä¼°
4. **å®¡æ ¸** - æŒ‡æ ‡è¯„ä¼°å’Œæ–¹æ¡ˆæ¨è
5. **æ–¹æ¡ˆåº“** - æ¸…æ´ç”Ÿäº§æ–¹æ¡ˆç®¡ç†
6. **æŠ¥å‘Š** - å®¡æ ¸æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡º

**æµç¨‹çŠ¶æ€æ§åˆ¶**

```python
class PCBEnterprise(BaseModel):
    audit_status = fields.CharField(max_length=50, default="pending")
    current_step = fields.IntField(default=0)
  
    # çŠ¶æ€æµè½¬: pending â†’ in_progress â†’ completed
    # æ­¥éª¤æ§åˆ¶: 0 â†’ 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ 6
```

### 2. æŒ‡æ ‡è¯„ä¼°ç³»ç»Ÿ

**64é¡¹å®¡æ ¸æŒ‡æ ‡**

- **å®šæ€§æŒ‡æ ‡**: ç¬¦åˆæ€§è¯„ä¼°ï¼Œé€šè¿‡/ä¸é€šè¿‡
- **å®šé‡æŒ‡æ ‡**: æ•°å€¼è®¡ç®—è¯„åˆ†ï¼ŒIçº§/IIçº§/IIIçº§/ä¸è¾¾æ ‡
- **é™å®šæ€§æŒ‡æ ‡**: å¼ºåˆ¶æ€§æ ‡å‡†ï¼Œå¿…é¡»è¾¾æ ‡

**è‡ªåŠ¨è¯„åˆ†ç®—æ³•**

```python
def calculate_score(level: str) -> float:
    score_map = {
        "Içº§": 100.0,
        "IIçº§": 80.0,
        "IIIçº§": 60.0,
        "ä¸è¾¾æ ‡": 0.0,
    }
    return score_map.get(level, 0.0)
```

**å®¡æ ¸æ±‡æ€»è®¡ç®—**

```python
async def calculate_summary(enterprise_id: int):
    results = await PCBAuditResult.filter(enterprise_id=enterprise_id).all()
  
    total_score = sum(result.score for result in results)
    overall_level = determine_overall_level(total_score)
    improvement_items = count_improvement_items(results)
    limiting_indicators_count = count_limiting_indicators(results)
  
    return {
        "total_score": total_score,
        "overall_level": overall_level,
        "improvement_items": improvement_items,
        "limiting_indicators_count": limiting_indicators_count
    }
```

### 3. æ–¹æ¡ˆæ¨èç³»ç»Ÿ

**130é¡¹æ¸…æ´ç”Ÿäº§æ–¹æ¡ˆ**

- æ¶µç›–ç”Ÿäº§å·¥è‰ºã€è®¾å¤‡æ”¹é€ ã€æ±¡æŸ“é˜²æ²»ç­‰å„ä¸ªæ–¹é¢
- æ¯é¡¹æ–¹æ¡ˆåŒ…å«ç»æµæ•ˆç›Šå’Œç¯å¢ƒæ•ˆç›Šåˆ†æ
- æ”¯æŒæ–¹æ¡ˆä¸æŒ‡æ ‡çš„æ™ºèƒ½å…³è”

**æ¨èç®—æ³•**

```python
async def get_indicator_recommended_schemes(enterprise_id: int, indicator_id: int):
    # è·å–æŒ‡æ ‡å…³è”çš„æ–¹æ¡ˆ
    relations = await PCBIndicatorSchemeRelation.filter(
        indicator_id=indicator_id
    ).order_by('-relevance_score').all()
  
    schemes = []
    for relation in relations:
        scheme = await PCBScheme.get_or_none(id=relation.scheme_id)
        if scheme and scheme.is_active:
            schemes.append({
                "scheme_id": scheme.scheme_id,
                "name": scheme.name,
                "relevance_score": float(relation.relevance_score),
                "priority": relation.priority,
                "recommendation_reason": relation.recommendation_reason
            })
  
    return schemes
```

### 4. æ•°æ®ç»Ÿè®¡åˆ†æ

**å¤šç»´åº¦æ•°æ®ç»Ÿè®¡**

- ä¼ä¸šåˆ†å¸ƒç»Ÿè®¡ï¼ˆæŒ‰åœ°åŒºã€è¡Œä¸šï¼‰
- å®¡æ ¸ç»“æœç»Ÿè®¡ï¼ˆæŒ‰ç­‰çº§ã€æŒ‡æ ‡ï¼‰
- æ–¹æ¡ˆå®æ–½ç»Ÿè®¡ï¼ˆæŒ‰ç±»å‹ã€æ•ˆæœï¼‰
- æ—¶é—´è¶‹åŠ¿åˆ†æï¼ˆå¹´åº¦å¯¹æ¯”ï¼‰

**æ•°æ®å¯¼å‡ºåŠŸèƒ½**

- æ”¯æŒExcelæ ¼å¼æ•°æ®å¯¼å‡º
- æ”¯æŒWordæ ¼å¼æŠ¥å‘Šç”Ÿæˆ
- æ”¯æŒPDFæ ¼å¼å®¡æ ¸æŠ¥å‘Š

## ğŸš€ éƒ¨ç½²ä¸è¿ç»´

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.11+
- **æ•°æ®åº“**: SQLite/MySQL/PostgreSQL
- **å†…å­˜**: æœ€å°2GBï¼Œæ¨è4GB+
- **å­˜å‚¨**: æœ€å°10GBï¼Œæ¨è50GB+

### éƒ¨ç½²æ­¥éª¤

**1. ç¯å¢ƒå‡†å¤‡**

```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export VITE_BASE_API=http://localhost:9999
```

**2. æ•°æ®åº“åˆå§‹åŒ–**

```bash
# è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨
python run.py

# åˆå§‹åŒ–åŸºç¡€æ•°æ®
python migrations/init_pcb_data.py
```

**3. å¯åŠ¨æœåŠ¡**

```bash
# å¼€å‘ç¯å¢ƒ
python run.py

# ç”Ÿäº§ç¯å¢ƒ
uvicorn app:app --host 0.0.0.0 --port 9999 --workers 4
```

### æ€§èƒ½ä¼˜åŒ–

**æ•°æ®åº“ä¼˜åŒ–**

- åˆç†è®¾ç½®ç´¢å¼•ï¼ˆä¼ä¸šIDã€æŒ‡æ ‡IDã€å®¡æ ¸çŠ¶æ€ç­‰ï¼‰
- ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢é¿å…å¤§æ•°æ®é‡æŸ¥è¯¢
- å®ç°è½¯åˆ é™¤æœºåˆ¶ä¿æŠ¤æ•°æ®å®Œæ•´æ€§

**APIä¼˜åŒ–**

- ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æé«˜å¹¶å‘æ€§èƒ½
- å®ç°è¯·æ±‚ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢
- æ‰¹é‡æ“ä½œæ¥å£æé«˜å¤„ç†æ•ˆç‡

**ç›‘æ§ä¸æ—¥å¿—**

- é›†æˆå®¡è®¡æ—¥å¿—ä¸­é—´ä»¶è®°å½•æ“ä½œ
- å®ç°é”™è¯¯ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- æ”¯æŒæ—¥å¿—åˆ†çº§å’Œè½®è½¬

## ğŸ”§ å¼€å‘è§„èŒƒ

### ä»£ç ç»“æ„

```
app/
â”œâ”€â”€ __init__.py              # åº”ç”¨åˆå§‹åŒ–
â”œâ”€â”€ settings/                # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py
â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ crud.py             # CRUDåŸºç±»
â”‚   â”œâ”€â”€ dependency.py       # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ exceptions.py       # å¼‚å¸¸å¤„ç†
â”‚   â””â”€â”€ init_app.py         # åº”ç”¨åˆå§‹åŒ–
â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py            # åŸºç¡€æ¨¡å‹
â”‚   â”œâ”€â”€ admin.py           # ç³»ç»Ÿç®¡ç†æ¨¡å‹
â”‚   â”œâ”€â”€ pcb.py             # PCBä¸šåŠ¡æ¨¡å‹
â”‚   â””â”€â”€ ...
â”œâ”€â”€ schemas/                 # æ•°æ®éªŒè¯
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ pcb.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ controllers/             # ä¸šåŠ¡æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ pcb.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ api/                     # APIè·¯ç”±
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ pcb.py
â”‚       â””â”€â”€ ...
â””â”€â”€ migrations/              # æ•°æ®è¿ç§»
    â””â”€â”€ init_pcb_data.py
```

### å‘½åè§„èŒƒ

- **æ–‡ä»¶å**: å°å†™å­—æ¯+ä¸‹åˆ’çº¿ (snake_case)
- **ç±»å**: å¤§é©¼å³°å‘½å (PascalCase)
- **å‡½æ•°å**: å°å†™å­—æ¯+ä¸‹åˆ’çº¿ (snake_case)
- **å¸¸é‡**: å¤§å†™å­—æ¯+ä¸‹åˆ’çº¿ (UPPER_CASE)

### æ³¨é‡Šè§„èŒƒ

```python
class PCBEnterprise(BaseModel, TimestampMixin):
    """PCBä¼ä¸šåŸºæœ¬ä¿¡æ¯è¡¨
  
    å­˜å‚¨PCBä¼ä¸šçš„åŸºæœ¬ä¿¡æ¯å’Œå®¡æ ¸è¿›åº¦
    æ”¯æŒå¤šåœ°åŒºã€å¤šè¡Œä¸šçš„ä¼ä¸šç®¡ç†
    """
    name = fields.CharField(max_length=200, description="ä¼ä¸šåç§°", index=True)
    # å…¶ä»–å­—æ®µ...
```

## ğŸ“Š æµ‹è¯•ä¸è´¨é‡ä¿è¯

### å•å…ƒæµ‹è¯•

**APIæµ‹è¯•ç¤ºä¾‹**

```python
async def test_create_enterprise():
    enterprise_data = {
        "name": "æµ‹è¯•ä¼ä¸š",
        "region": "æ·±åœ³å¸‚",
        "district": "å®å®‰åŒº"
    }
  
    response = await client.post("/api/v1/pcb/enterprise", json=enterprise_data)
    assert response.status_code == 200
  
    data = response.json()
    assert data["code"] == 200
    assert data["data"]["name"] == "æµ‹è¯•ä¼ä¸š"
```

### é›†æˆæµ‹è¯•

**å®Œæ•´æµç¨‹æµ‹è¯•**

1. åˆ›å»ºä¼ä¸š â†’ é¢„å®¡æ ¸æ•°æ®å¡«æŠ¥ â†’ æŒ‡æ ‡å®¡æ ¸ â†’ æ–¹æ¡ˆé€‰æ‹© â†’ æŠ¥å‘Šç”Ÿæˆ
2. ç”¨æˆ·æƒé™éªŒè¯ â†’ APIè®¿é—®æ§åˆ¶ â†’ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
3. å‰åç«¯æ•°æ®äº¤äº’ â†’ é”™è¯¯å¤„ç† â†’ æ€§èƒ½æµ‹è¯•

### ä»£ç è´¨é‡

- **ç±»å‹æ£€æŸ¥**: ä½¿ç”¨ mypy è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥
- **ä»£ç æ ¼å¼**: ä½¿ç”¨ black å’Œ isort ç»Ÿä¸€ä»£ç æ ¼å¼
- **å®‰å…¨æ£€æŸ¥**: ä½¿ç”¨ bandit è¿›è¡Œå®‰å…¨æ¼æ´æ‰«æ
- **æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£å’Œä»£ç æ–‡æ¡£

## ğŸ”® æŠ€æœ¯å±•æœ›

### çŸ­æœŸä¼˜åŒ–

1. **æ€§èƒ½æå‡**

   - å®ç°Redisç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
   - æ·»åŠ APIå“åº”å‹ç¼©
2. **åŠŸèƒ½å¢å¼º**

   - å®ç°å®æ—¶æ•°æ®åŒæ­¥
   - æ·»åŠ æ•°æ®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
   - æ”¯æŒå¤šè¯­è¨€å›½é™…åŒ–
3. **ç›‘æ§å®Œå–„**

   - é›†æˆAPMæ€§èƒ½ç›‘æ§
   - å®ç°ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
   - æ·»åŠ è‡ªåŠ¨åŒ–å‘Šè­¦

### é•¿æœŸè§„åˆ’

1. **å¾®æœåŠ¡æ¶æ„**

   - æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æœåŠ¡
   - å®ç°æœåŠ¡é—´é€šä¿¡
   - æ”¯æŒç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
2. **å¤§æ•°æ®åˆ†æ**

   - é›†æˆæ•°æ®ä»“åº“
   - å®ç°æœºå™¨å­¦ä¹ ç®—æ³•
   - æ”¯æŒé¢„æµ‹åˆ†æ
3. **äº‘åŸç”Ÿéƒ¨ç½²**

   - å®¹å™¨åŒ–éƒ¨ç½²
   - Kubernetesç¼–æ’
   - è‡ªåŠ¨æ‰©ç¼©å®¹

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PCBæ¨¡å—åç«¯å®ç°è¯´æ˜.md](./PCBæ¨¡å—åç«¯å®ç°è¯´æ˜.md)
- [PCBå‰åç«¯é›†æˆå®ŒæˆæŠ¥å‘Š.md](./PCBå‰åç«¯é›†æˆå®ŒæˆæŠ¥å‘Š.md)
- [PCBå‰åç«¯äº¤äº’é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ.md](./PCBå‰åç«¯äº¤äº’é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ.md)
- [é’¢é“æ¨¡å—å®ç°æ€»ç»“.md](./é’¢é“æ¨¡å—å®ç°æ€»ç»“.md)
- [PCB æ¸…æ´ç”Ÿäº§æ–¹æ¡ˆ.md](./PCB%20æ¸…æ´ç”Ÿäº§æ–¹æ¡ˆ.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**ç»´æŠ¤å›¢é˜Ÿ**: æ¸…æ´ç”Ÿäº§æ™ºæ…§å®¡æ ¸å¹³å°å¼€å‘ç»„
**æŠ€æœ¯æ ˆ**: FastAPI + Tortoise ORM + Pydantic + SQLite
